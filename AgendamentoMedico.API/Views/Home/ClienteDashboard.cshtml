@{
    ViewData["Title"] = "Agendar Consulta";
}

<h2>Marcar Consulta</h2>
<div id="calendar"></div>

@section Scripts {
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css"
          rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
          var calendarEl = document.getElementById('calendar');
          var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'timeGridWeek',
            events: '/Home/GetHorariosDisponiveis',
            dateClick: function(info) {
              if (confirm('Agendar para ' + info.dateStr + '?')) {
                fetch('/Home/Agendar', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ horarioId: info.dateStrId })
                }).then(() => window.location.reload());
              }
            }
          });
          calendar.render();
        });
    </script>
}
